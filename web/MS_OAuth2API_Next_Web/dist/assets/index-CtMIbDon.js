import{d as Re,r as u,b as le,e as Le,n as Be,f as Ue,c as Ne,g as l,h as x,w as a,i as f,j as c,u as S,p as Pe,t as Ie,k as $e,l as Ee,m as te,q as Je,s as Me,v as je,E as i,x as C,o as Fe,_ as He}from"./index-AoRyj5eV.js";const Ae={class:"home-container"},De={class:"table"},qe={class:"copy-textarea-container"},We={class:"dialog-footer"},Xe={class:"dialog-footer"},Ge={class:"table"},Ke=["innerHTML"],Qe=Re({__name:"index",setup(Ye){const V=u(),h=u([]),k=u(""),ae=t=>{V.value.clearFiles();const e=t[0];e.uid=je(),V.value.handleStart(e)},oe=(t,e=[])=>{if(e.length===0){k.value="";return}const o=e[0]?.raw;if(!o){k.value="";return}if(!o.type.match(/text\/(plain|csv)/)&&!o.name.endsWith(".txt")&&!o.name.endsWith(".csv")){i.error("请上传 .txt 或 .csv 格式的文件"),V.value.clearFiles(),k.value="";return}k.value=o.name.length>10?o.name.slice(0,10)+"...":o.name,ne(o)},ne=t=>{const e=new FileReader;e.onload=o=>{try{const s=o.target?.result;if(!s){i.error("文件内容为空");return}const v=s.split(`
`);v?h.value=v:(i.warning("未在文件中找到邮箱地址"),h.value=[])}catch(s){console.error("解析文件失败:",s),i.error("解析文件失败，请检查文件格式")}},e.onerror=()=>{i.error("读取文件失败")},e.readAsText(t)},g=u({splitSymbol:"----"}),se=u({splitSymbol:[{required:!0,message:"请输入分隔符",trigger:"blur"}]}),q=u(),z=u([]),W=(t,e)=>{q.value.clearSelection()},ie=t=>{z.value=t},d=u(JSON.parse(localStorage.getItem("localMailList")||"[]")),p=u({currentPage:1,pageSize:5,defaultSize:"default",total:d.value.length}),ue=le(()=>{const t=(p.value.currentPage-1)*p.value.pageSize,e=t+p.value.pageSize;return d.value.slice(t,e)}),re=t=>{p.value.pageSize=t},de=t=>{p.value.currentPage=t},T=u(),J=u(0),O=u(),M=u(0),ce=le(()=>`calc(100vh - ${J.value}px - ${M.value}px - 40px - 140px)`);let R=null,L=null,B=null;const X=()=>{T.value?.$el&&(J.value=T.value.$el.offsetHeight||0),O.value&&(M.value=O.value.offsetHeight||0)};Le(()=>{Be(()=>{X(),T.value?.$el&&(R=new ResizeObserver(t=>{for(const e of t)J.value=e.contentRect.height}),R.observe(T.value.$el)),O.value&&(L=new ResizeObserver(t=>{for(const e of t)M.value=e.contentRect.height}),L.observe(O.value)),B=()=>{X()},window.addEventListener("resize",B)})}),Ue(()=>{R&&(R.disconnect(),R=null),L&&(L.disconnect(),L=null),B&&(window.removeEventListener("resize",B),B=null)});const pe=()=>{if(z.value.length===0){i.warning("请选择要删除的邮箱");return}C.confirm("确认删除选中的邮箱吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.value=d.value.filter(t=>!z.value.includes(t)),p.value.total=d.value.length,localStorage.setItem("localMailList",JSON.stringify(d.value)),W(),i.success("删除成功")}).catch(()=>{i.info("已取消删除")})},ve=()=>{C.confirm("确认删除所有邮箱吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.value=[],p.value.total=0,localStorage.setItem("localMailList",JSON.stringify(d.value)),W(),i.success("删除成功")}).catch(()=>{i.info("已取消删除")})},G=()=>{if(h.value.length===0){i.warning("请先选择文件解析");return}const t=JSON.parse(localStorage.getItem("localMailList")||"[]");d.value=t.concat(h.value.map(e=>{const o=e.split(g.value.splitSymbol);return{email:o[0]||"",password:o[1]||"",client_id:o[2]||"",refresh_token:o[3]||""}})),localStorage.setItem("localMailList",JSON.stringify(d.value)),p.value.total=d.value.length,i.success("邮箱地址添加成功共"+h.value.length+"条"),h.value=[],I.value="",U.value=!1,k.value="",V.value.clearFiles()},U=u(!1),I=u(""),fe=()=>{h.value=I.value.split(`
`).map(t=>t.trim()).filter(t=>t!==""),G()},me=()=>{if(z.value.length===0){i.warning("请选择要导出的邮箱");return}C.confirm("确认导出选中的邮箱吗？","导出确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=z.value.map(s=>s.email+g.value.splitSymbol+s.password+g.value.splitSymbol+s.client_id+g.value.splitSymbol+s.refresh_token).join(`
`),e=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(e),o.download="selected_mails.txt",o.click(),URL.revokeObjectURL(o.href),i.success("导出成功")}).catch(()=>{i.info("已取消导出")})},ge=()=>{if(d.value.length===0){i.warning("请先添加邮箱");return}C.confirm("确认导出所有邮箱吗？","导出确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=d.value.map(s=>s.email+g.value.splitSymbol+s.password+g.value.splitSymbol+s.client_id+g.value.splitSymbol+s.refresh_token).join(`
`),e=new Blob([t],{type:"text/plain"}),o=document.createElement("a");o.href=URL.createObjectURL(e),o.download="all_mails.txt",o.click(),URL.revokeObjectURL(o.href),i.success("导出成功")}).catch(()=>{i.info("已取消导出")})},N=u(!1),m=u({email:"",password:"",client_id:"",refresh_token:""}),j=u(-1),_e=(t,e)=>{j.value=(p.value.currentPage-1)*p.value.pageSize+e,m.value=JSON.parse(JSON.stringify(t)),N.value=!0},ye=()=>{if(j.value===-1){i.error("编辑索引错误");return}d.value[j.value]=m.value,localStorage.setItem("localMailList",JSON.stringify(d.value)),p.value.total=d.value.length,N.value=!1,i.success("保存成功")},we=(t,e)=>{C.confirm("确认删除邮箱 "+t.email+" 吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{d.value.splice(e,1),localStorage.setItem("localMailList",JSON.stringify(d.value)),p.value.total=d.value.length,i.success("删除成功")}).catch(()=>{i.info("已取消删除")})},F=u(!1),w=u("INBOX"),b=u([]),H=u(""),y=u({email:"",password:"",client_id:"",refresh_token:""}),A=u(!1),be=t=>{w.value="INBOX",H.value=t.email+"的收件箱",K(t)},he=t=>{w.value="Junk",H.value=t.email+"的垃圾箱",K(t)},K=t=>{y.value=t,b.value=JSON.parse(localStorage.getItem(t.email+w.value)||"[]"),Q(t.email,t.password,t.client_id,t.refresh_token,w.value),F.value=!0},xe=()=>{const{email:t,password:e,client_id:o,refresh_token:s}=y.value;Q(t,e,o,s,w.value)},Q=async(t,e,o,s,v)=>{A.value=!0;try{const P=await(await fetch("/api/mail_all",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e,client_id:o,refresh_token:s,mailbox:v})})).json();P.code==200?(b.value=P.data,localStorage.setItem(y.value.email+w.value,JSON.stringify(b.value)),i.success("收取成功")):i.error(P.message||"收取失败")}catch{i.error("收取失败")}A.value=!1},D=u(!1),Y=u(""),Se=t=>{D.value=!0,Y.value=t.html},ke=()=>{C.confirm("确认清空邮箱 "+y.value.email+" 的所有邮件吗？","清空确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.value=[],localStorage.setItem(y.value.email+w.value,JSON.stringify(b.value)),Ce(y.value.email,y.value.password,y.value.client_id,y.value.refresh_token,w.value),i.success("邮箱正在清空中... 请稍后查看")}).catch(()=>{i.info("已取消清空")})},Ce=(t,e,o,s,v)=>{fetch("/api/process-mailbox",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e,client_id:o,refresh_token:s,mailbox:v})})};return(t,e)=>{const o=f("el-input"),s=f("el-form-item"),v=f("el-icon"),r=f("el-button"),P=f("el-upload"),Ve=f("el-col"),ze=f("el-row"),Z=f("el-form"),_=f("el-table-column"),ee=f("el-table"),Te=f("el-pagination"),Oe=f("el-text"),$=f("el-dialog");return Fe(),Ne("div",Ae,[l(Z,{model:g.value,rules:se.value,ref_key:"formRef",ref:T,inline:!0},{default:a(()=>[l(ze,null,{default:a(()=>[l(Ve,{span:24},{default:a(()=>[l(s,{label:"分隔符：","label-width":"70px"},{default:a(()=>[l(o,{modelValue:g.value.splitSymbol,"onUpdate:modelValue":e[0]||(e[0]=n=>g.value.splitSymbol=n)},null,8,["modelValue"])]),_:1}),l(s,null,{default:a(()=>[l(P,{ref_key:"upload",ref:V,limit:1,"show-file-list":!1,"on-exceed":ae,"auto-upload":!1,"on-change":oe,accept:".txt,.csv",class:"custom-upload"},{trigger:a(()=>[l(r,{type:"primary"},{default:a(()=>[l(v,null,{default:a(()=>[l(S(Pe))]),_:1}),c(" "+Ie(k.value||"选择文件"),1)]),_:1})]),_:1},512)]),_:1}),l(s,null,{default:a(()=>[l(r,{type:"success",onClick:G},{default:a(()=>[l(v,null,{default:a(()=>[l(S($e))]),_:1}),e[16]||(e[16]=c(" 导入邮箱 ",-1))]),_:1})]),_:1}),l(s,null,{default:a(()=>[l(r,{type:"success",onClick:e[1]||(e[1]=n=>U.value=!0)},{default:a(()=>[l(v,null,{default:a(()=>[l(S(Ee))]),_:1}),e[17]||(e[17]=c(" 粘贴导入 ",-1))]),_:1})]),_:1}),l(s,null,{default:a(()=>[l(r,{type:"warning",onClick:me},{default:a(()=>[l(v,null,{default:a(()=>[l(S(te))]),_:1}),e[18]||(e[18]=c(" 批量导出 ",-1))]),_:1})]),_:1}),l(s,null,{default:a(()=>[l(r,{type:"warning",onClick:ge},{default:a(()=>[l(v,null,{default:a(()=>[l(S(te))]),_:1}),e[19]||(e[19]=c(" 全部导出 ",-1))]),_:1})]),_:1}),l(s,null,{default:a(()=>[l(r,{type:"warning",onClick:pe},{default:a(()=>[l(v,null,{default:a(()=>[l(S(Je))]),_:1}),e[20]||(e[20]=c(" 批量删除 ",-1))]),_:1})]),_:1}),l(s,null,{default:a(()=>[l(r,{type:"danger",onClick:ve},{default:a(()=>[l(v,null,{default:a(()=>[l(S(Me))]),_:1}),e[21]||(e[21]=c(" 全部删除 ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),x("div",De,[l(ee,{ref_key:"multipleTableRef",ref:q,height:ce.value,stripe:"",data:ue.value,"row-key":"email",style:{width:"100%"},size:"large",onSelectionChange:ie,center:""},{default:a(()=>[l(_,{type:"selection",width:"55"}),l(_,{"show-overflow-tooltip":"",prop:"email",label:"邮箱"}),l(_,{"show-overflow-tooltip":"",prop:"client_id",label:"客户端ID"}),l(_,{"show-overflow-tooltip":"",prop:"refresh_token",label:"刷新令牌"}),l(_,{label:"操作",width:"300"},{default:a(n=>[l(r,{size:"small",type:"primary",onClick:E=>_e(n.row,n.$index)},{default:a(()=>[...e[22]||(e[22]=[c(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"success",onClick:E=>be(n.row)},{default:a(()=>[...e[23]||(e[23]=[c(" 收件箱 ",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"success",onClick:E=>he(n.row)},{default:a(()=>[...e[24]||(e[24]=[c(" 垃圾箱 ",-1)])]),_:1},8,["onClick"]),l(r,{size:"small",type:"danger",onClick:E=>we(n.row,n.$index)},{default:a(()=>[...e[25]||(e[25]=[c(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["height","data"])]),x("div",{class:"pagination",ref_key:"tablePaginationRef",ref:O},[l(Te,{background:"","current-page":p.value.currentPage,"onUpdate:currentPage":e[2]||(e[2]=n=>p.value.currentPage=n),"page-size":p.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=n=>p.value.pageSize=n),"page-sizes":[5,10,20,50,100],size:p.value.defaultSize,layout:"total, sizes, prev, pager, next",total:p.value.total,onSizeChange:re,onCurrentChange:de},null,8,["current-page","page-size","size","total"])],512),l($,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=n=>U.value=n),title:"粘贴导入",width:"800"},{footer:a(()=>[x("div",We,[l(r,{onClick:e[5]||(e[5]=n=>U.value=!1)},{default:a(()=>[...e[27]||(e[27]=[c("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:fe},{default:a(()=>[...e[28]||(e[28]=[c(" 导入 ",-1)])]),_:1})])]),default:a(()=>[l(Oe,{class:"mx-1",type:"warning"},{default:a(()=>[...e[26]||(e[26]=[c("请粘贴邮箱地址（每个邮箱地址占一行）",-1)])]),_:1}),x("div",qe,[l(o,{modelValue:I.value,"onUpdate:modelValue":e[4]||(e[4]=n=>I.value=n),style:{width:"100%"},rows:20,type:"textarea",placeholder:"请粘贴邮箱地址"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),l($,{modelValue:N.value,"onUpdate:modelValue":e[12]||(e[12]=n=>N.value=n),title:"编辑",width:"800"},{footer:a(()=>[x("div",Xe,[l(r,{onClick:e[11]||(e[11]=n=>N.value=!1)},{default:a(()=>[...e[29]||(e[29]=[c("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:ye},{default:a(()=>[...e[30]||(e[30]=[c(" 保存 ",-1)])]),_:1})])]),default:a(()=>[l(Z,{model:m.value,ref:"editFormRef","label-width":"120px"},{default:a(()=>[l(s,{label:"邮箱",prop:"email"},{default:a(()=>[l(o,{modelValue:m.value.email,"onUpdate:modelValue":e[7]||(e[7]=n=>m.value.email=n),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(s,{label:"密码",prop:"password"},{default:a(()=>[l(o,{modelValue:m.value.password,"onUpdate:modelValue":e[8]||(e[8]=n=>m.value.password=n),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(s,{label:"客户端ID",prop:"client_id"},{default:a(()=>[l(o,{modelValue:m.value.client_id,"onUpdate:modelValue":e[9]||(e[9]=n=>m.value.client_id=n),placeholder:"请输入客户端ID"},null,8,["modelValue"])]),_:1}),l(s,{label:"刷新令牌",prop:"refresh_token"},{default:a(()=>[l(o,{modelValue:m.value.refresh_token,"onUpdate:modelValue":e[10]||(e[10]=n=>m.value.refresh_token=n),type:"textarea",rows:10,placeholder:"请输入刷新令牌"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l($,{modelValue:F.value,"onUpdate:modelValue":e[14]||(e[14]=n=>F.value=n),title:H.value,width:"1000"},{default:a(()=>[l(r,{type:"primary",onClick:xe,loading:A.value},{default:a(()=>[...e[31]||(e[31]=[c(" 收取新邮件 ",-1)])]),_:1},8,["loading"]),l(r,{type:"danger",onClick:ke},{default:a(()=>[...e[32]||(e[32]=[c(" 清空 ",-1)])]),_:1}),x("div",Ge,[l(ee,{modelValue:b.value,"onUpdate:modelValue":e[13]||(e[13]=n=>b.value=n),style:{width:"100%"},size:"default",data:b.value,height:"calc(100vh - 350px)"},{default:a(()=>[l(_,{prop:"send",label:"发件人","show-overflow-tooltip":""}),l(_,{prop:"subject",label:"主题","show-overflow-tooltip":""}),l(_,{prop:"text",label:"文本","show-overflow-tooltip":""}),l(_,{prop:"date",label:"日期","show-overflow-tooltip":""}),l(_,{label:"操作",width:"120"},{default:a(n=>[l(r,{size:"small",type:"primary",onClick:E=>Se(n.row)},{default:a(()=>[...e[33]||(e[33]=[c(" 查看 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["modelValue","data"])])]),_:1},8,["modelValue","title"]),l($,{modelValue:D.value,"onUpdate:modelValue":e[15]||(e[15]=n=>D.value=n),title:"邮件内容",width:"800"},{default:a(()=>[x("div",{innerHTML:Y.value,style:{height:"calc(100vh - 400px)",overflow:"auto"}},null,8,Ke)]),_:1},8,["modelValue"])])}}}),el=He(Qe,[["__scopeId","data-v-8462f697"]]);export{el as default};
